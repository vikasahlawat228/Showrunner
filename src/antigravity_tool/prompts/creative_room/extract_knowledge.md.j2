{# Template: Extract Reader Knowledge After Scene #}
{# Step: creative_room #}
{# access_level: story (operates on scene data, not creative room) #}

# Task: Extract Reader Knowledge State

After Chapter {{ chapter_num }}, Scene {{ scene_num }}, what does the reader now know?

{% if scene %}
## Scene Just Completed

- **Title**: {{ scene.title }}
- **Summary**: {{ scene.summary }}
- **Characters Present**: {{ scene.characters_present | join(', ') if scene.characters_present else 'None' }}
- **Location**: {{ scene.location_name }}
- **Key Events**: {{ scene.key_events | join('; ') if scene.key_events else 'None' }}
- **Reveals**: {{ scene.reveals | join('; ') if scene.reveals else 'None' }}
{% endif %}

{% if previous_knowledge %}
## Previous Reader Knowledge State

- **Known Characters**: {{ previous_knowledge.known_characters | join(', ') if previous_knowledge.known_characters else 'None' }}
- **Known Locations**: {{ previous_knowledge.known_locations | join(', ') if previous_knowledge.known_locations else 'None' }}
- **Known World Rules**: {{ previous_knowledge.known_world_rules | join(', ') if previous_knowledge.known_world_rules else 'None' }}
- **Known Relationships**: {{ previous_knowledge.known_relationships | join(', ') if previous_knowledge.known_relationships else 'None' }}
- **Active Questions**: {{ previous_knowledge.active_questions | join(', ') if previous_knowledge.active_questions else 'None' }}
- **False Beliefs**: {{ previous_knowledge.false_beliefs | join(', ') if previous_knowledge.false_beliefs else 'None' }}
{% endif %}

## Instructions

Analyze what the reader has learned (or been misled about) in this scene. Update the knowledge state by adding new knowledge and tracking new questions.

Consider:
1. Which characters did the reader meet or learn new things about?
2. What locations are now known?
3. What world rules or mechanics were demonstrated?
4. What relationships were revealed or hinted at?
5. What questions should the reader now be asking?
6. Were any previous false beliefs corrected or reinforced?
7. Were any NEW false beliefs introduced (through misleading information)?

## Output Format

```yaml
chapter_id: "chapter-{{ '%02d' | format(chapter_num) }}"
scene_id: "scene-{{ '%02d' | format(scene_num) }}"
position_label: "after chapter {{ chapter_num }} scene {{ scene_num }}"
known_characters:
  - "all characters the reader has met so far"
known_character_traits:
  character_name:
    - "trait the reader has observed"
known_locations:
  - "all locations the reader has seen"
known_world_rules:
  - "rules the reader understands"
known_relationships:
  - "char_a -> char_b: relationship type"
revealed_secrets: []
active_questions:
  - "mystery or question the reader is tracking"
false_beliefs:
  - "things the reader believes that are actually wrong"
```
